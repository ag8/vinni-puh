<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup - Земля Винни-Пуха</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #2c1810;
            color: #f5e6d3;
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #d4a574;
        }

        .instructions {
            text-align: center;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .container {
            display: flex;
            gap: 20px;
            height: calc(100vh - 120px);
        }

        .video-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .level-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .level-btn {
            flex: 1;
            padding: 12px;
            font-size: 1rem;
            background: #3d2317;
            color: #f5e6d3;
            border: 2px solid #d4a574;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .level-btn:hover {
            background: #5a3825;
        }

        .level-btn.active {
            background: #8b5a2b;
            border-color: gold;
        }

        .video-container {
            flex: 1;
            background: #1a0d08;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #clip-video {
            max-width: 100%;
            max-height: 100%;
        }

        .video-controls {
            display: flex;
            gap: 10px;
        }

        .video-controls button {
            flex: 1;
            padding: 10px;
            font-size: 1rem;
            background: #3d2317;
            color: #f5e6d3;
            border: 2px solid #d4a574;
            border-radius: 8px;
            cursor: pointer;
        }

        .video-controls button:hover {
            background: #5a3825;
        }

        .map-panel {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-container {
            flex: 1;
            position: relative;
            border: 4px solid #d4a574;
            border-radius: 10px;
            overflow: hidden;
            cursor: crosshair;
        }

        #map-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #map-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .pin {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 4px solid white;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 0 3px rgba(0,0,0,0.7), 0 3px 8px rgba(0,0,0,0.5);
            background: gold;
            z-index: 10;
        }

        .pin::after {
            content: attr(data-level);
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .output-panel {
            background: #1a0d08;
            border: 2px solid #d4a574;
            border-radius: 10px;
            padding: 15px;
        }

        .output-panel h3 {
            margin-bottom: 10px;
            color: #d4a574;
        }

        .coordinates {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .coord-item {
            background: #3d2317;
            padding: 10px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .coord-item .label {
            color: #d4a574;
            font-weight: bold;
        }

        .coord-item .value {
            font-family: monospace;
            font-size: 1.1rem;
        }

        .coord-item.current {
            border: 2px solid gold;
        }

        #code-output {
            width: 100%;
            height: 150px;
            background: #0d0d0d;
            color: #4ec9b0;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            resize: none;
        }

        .copy-btn {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 1rem;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background: #2ecc71;
        }

        .copy-btn.copied {
            background: #8b5a2b;
        }
    </style>
</head>
<body>
    <h1>Setup: Установка правильных ответов</h1>
    <p class="instructions">Выберите уровень, посмотрите видео, затем кликните на карте, чтобы установить правильное местоположение.</p>

    <div class="container">
        <div class="video-panel">
            <div class="level-selector">
                <button class="level-btn active" onclick="selectLevel(0)">Уровень 1</button>
                <button class="level-btn" onclick="selectLevel(1)">Уровень 2</button>
                <button class="level-btn" onclick="selectLevel(2)">Уровень 3</button>
            </div>
            <div class="video-container">
                <video id="clip-video" controls></video>
            </div>
            <div class="video-controls">
                <button onclick="replayVideo()">▶ Воспроизвести</button>
            </div>
        </div>

        <div class="map-panel">
            <div class="map-container" onclick="setPin(event)">
                <div id="map-wrapper">
                    <img id="map-image" src="map.jpg" alt="Map">
                </div>
            </div>
            <div class="output-panel">
                <h3>Координаты</h3>
                <div class="coordinates">
                    <div class="coord-item" id="coord-0">
                        <span class="label">Ур.1:</span>
                        <span class="value" id="coord-value-0">не установлено</span>
                    </div>
                    <div class="coord-item" id="coord-1">
                        <span class="label">Ур.2:</span>
                        <span class="value" id="coord-value-1">не установлено</span>
                    </div>
                    <div class="coord-item" id="coord-2">
                        <span class="label">Ур.3:</span>
                        <span class="value" id="coord-value-2">не установлено</span>
                    </div>
                </div>
                <textarea id="code-output" readonly></textarea>
                <button class="copy-btn" onclick="copyCode()">Копировать код</button>
            </div>
        </div>
    </div>

    <script>
        const LEVELS = [
            { video: 'assets/clip_1_48-1_49.mp4', correctX: null, correctY: null },
            { video: 'assets/clip_4_38-4_44.mp4', correctX: null, correctY: null },
            { video: 'assets/clip_9_33-9_39.mp4', correctX: null, correctY: null }
        ];

        let currentLevel = 0;

        function selectLevel(level) {
            currentLevel = level;

            // Update buttons
            document.querySelectorAll('.level-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === level);
            });

            // Update coordinate highlight
            document.querySelectorAll('.coord-item').forEach((item, i) => {
                item.classList.toggle('current', i === level);
            });

            // Load video
            const video = document.getElementById('clip-video');
            video.src = LEVELS[level].video;
            video.play();
        }

        function replayVideo() {
            const video = document.getElementById('clip-video');
            video.currentTime = 0;
            video.play();
        }

        function setPin(event) {
            const wrapper = document.getElementById('map-wrapper');
            const rect = wrapper.getBoundingClientRect();

            const x = ((event.clientX - rect.left) / rect.width) * 100;
            const y = ((event.clientY - rect.top) / rect.height) * 100;

            // Store coordinates
            LEVELS[currentLevel].correctX = Math.round(x * 10) / 10;
            LEVELS[currentLevel].correctY = Math.round(y * 10) / 10;

            // Update display
            updateDisplay();
            updatePins();
        }

        function updateDisplay() {
            LEVELS.forEach((level, i) => {
                const valueEl = document.getElementById(`coord-value-${i}`);
                if (level.correctX !== null) {
                    valueEl.textContent = `X: ${level.correctX}%, Y: ${level.correctY}%`;
                } else {
                    valueEl.textContent = 'не установлено';
                }
            });

            // Generate code
            const code = `const LEVELS = [
    {
        video: 'assets/clip_1_48-1_49.mp4',
        correctX: ${LEVELS[0].correctX ?? 'null'},
        correctY: ${LEVELS[0].correctY ?? 'null'}
    },
    {
        video: 'assets/clip_4_38-4_44.mp4',
        correctX: ${LEVELS[1].correctX ?? 'null'},
        correctY: ${LEVELS[1].correctY ?? 'null'}
    },
    {
        video: 'assets/clip_9_33-9_39.mp4',
        correctX: ${LEVELS[2].correctX ?? 'null'},
        correctY: ${LEVELS[2].correctY ?? 'null'}
    }
];`;
            document.getElementById('code-output').value = code;
        }

        function updatePins() {
            const wrapper = document.getElementById('map-wrapper');

            // Remove existing pins
            wrapper.querySelectorAll('.pin').forEach(pin => pin.remove());

            // Add pins for all set coordinates
            LEVELS.forEach((level, i) => {
                if (level.correctX !== null) {
                    const pin = document.createElement('div');
                    pin.className = 'pin';
                    pin.style.left = `${level.correctX}%`;
                    pin.style.top = `${level.correctY}%`;
                    pin.dataset.level = i + 1;
                    wrapper.appendChild(pin);
                }
            });
        }

        function copyCode() {
            const textarea = document.getElementById('code-output');
            textarea.select();
            document.execCommand('copy');

            const btn = document.querySelector('.copy-btn');
            btn.textContent = 'Скопировано!';
            btn.classList.add('copied');
            setTimeout(() => {
                btn.textContent = 'Копировать код';
                btn.classList.remove('copied');
            }, 2000);
        }

        // Initialize
        selectLevel(0);
        updateDisplay();
    </script>
</body>
</html>
